<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>BLOG</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link href="/css/bootstrap.min.css" rel="stylesheet"><link href="/css/font-awesome.min.css" rel="stylesheet"><link href="/css/main.css" rel="stylesheet"><meta name="generator" content="Hexo 6.1.0"></head><body><div class="wrap"><nav class="page-navigation"><div class="nav-container"><div class="page-header-logo"><h1 class="prince-log"><a href="/" class="home-link">Hello</a></h1></div><button type="button" data-toggle="collapse" data-target=".main-nav-items" class="navbar-toggle"><span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button><ul class="collapse navbar-collapse main-nav-items"><li class="menu-item"><a href="/" target="_self">HOME</a></li><li class="menu-item"><a href="/archives/" target="_self">ARCHIVE</a></li></ul></div></nav><main class="prince-container"><div class="post"><article class="post-block"><h1 class="post-title">4-25</h1><div class="post-info">Apr 25th 2022</div><div class="post-entry"><h4 id="作业三：-部署-es-kibana"><a href="#作业三：-部署-es-kibana" class="headerlink" title="作业三： 部署 es + kibana"></a>作业三： 部署 es + kibana</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 暴露端口多！</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 十分耗内存</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">es 的数据一般要放到安全目录！挂载</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">--net somenetwork 网络配置，暂时不需要，删除</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载启动elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看端口</span></span><br><span class="line">curl localhost:9200</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看cpu memory状态</span></span><br><span class="line">docker stats  # elasticsearch 占了1.2G内存!</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">添加内存限制：修改配置文件， -e 环境配置修改</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xms512m&quot; elasticsearch:7.6.2</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">kibana  是用来连接elasticsearch</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">容器间隔离，两容器 how to connect?</span></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220425100521739.png" alt="image-20220425100521739"></p>
<h3 id="Docker可视化"><a href="#Docker可视化" class="headerlink" title="Docker可视化"></a>Docker可视化</h3><p>– just learn or not use, 浅玩即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载安装 portainer</span></span><br><span class="line">docker run -d -p 8088:9000 --restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="Docker-底层架构"><a href="#Docker-底层架构" class="headerlink" title="Docker 底层架构"></a>Docker 底层架构</h3><p>bootfs(boot file system) 主要包含bootloader 和 kernel。类似于操作系统：Ubuntu， Centos等。</p>
<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220425103548039.png" alt="image-20220425103548039"></p>
<p>一个OS的rootfs可以很小，只需包含基本命令+工具+程序库即可。因为底层使用的是宿主机Host的kernel。</p>
<p>所以！！下载镜像的时候是一层一层下载的！！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">下载镜像redis</span></span><br><span class="line">docker pull redis</span><br><span class="line">docker image inspect redis:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20220425105944982.png" alt="image-20220425105944982"></p>
<p>!! Docker 的镜像都是只读的，容器被放到镜像的顶部用于可写层！</p>
<p>所以顶层 -&gt; 容器层， 下面的层为镜像层！！</p>
<blockquote>
<p> How to 提交一个自己的镜像</p>
</blockquote>
<h3 id="commit-镜像"><a href="#commit-镜像" class="headerlink" title="commit 镜像"></a>commit 镜像</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker commit # 提交容器成为一个新的副本</span><br><span class="line"></span><br><span class="line">docker commit -m=&quot;提交的描述信息&quot; -a=&quot;作者&quot; 容器ID name</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">1.启动tomcat</span></span><br><span class="line">docker run -it -p 8080:8080 tomcat</span><br><span class="line">docker exec -it ID /bin/bash</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">2.copy file</span></span><br><span class="line">cp -r webapps.dist/* webapps</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">tips: 在防火墙中添加规则即可使用 8080 port</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">3. 提交自己的镜像</span></span><br><span class="line">docker commit -a=&quot;yajun&quot; -m=&quot;add webapps application&quot; ID tomcat02:1.0</span><br><span class="line">docker images # 可发现存在tomcat02</span><br></pre></td></tr></table></figure>

<blockquote>
<p>想保存当前容器状态，可以通过commit提交来get一个新镜像。</p>
</blockquote>
<p>以上仅仅入门</p>
<p>下面为docker精髓：</p>
<ul>
<li>容器数据卷</li>
<li>DockerFile</li>
<li>Docker 网络</li>
</ul>
<p>企业实战：</p>
<ul>
<li>Docker Compose    集群部署</li>
<li>Docker Swarm         打包</li>
<li>CI&#x2F;CD Jenkins           流水线</li>
</ul>
</div></article></div><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%9C%E4%B8%9A%E4%B8%89%EF%BC%9A-%E9%83%A8%E7%BD%B2-es-kibana"><span class="toc-text">作业三： 部署 es + kibana</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker%E5%8F%AF%E8%A7%86%E5%8C%96"><span class="toc-text">Docker可视化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-%E5%BA%95%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-text">Docker 底层架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#commit-%E9%95%9C%E5%83%8F"><span class="toc-text">commit 镜像</span></a><div class="post-nav"><div class="prev-wrap col-md-6 col-xs-6"><i class="fa fa-angle-double-left"></i><a href="/2022/04/25/Docker-%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7/" class="prev-post">Docker 容器数据卷</a></div><div class="next-wrap col-md-6 col-xs-6"><a href="/2022/04/23/4-23/" class="next-post">4-23</a><i class="fa fa-angle-double-right"></i></div></div></main></div><footer><div class="copyright"><p>Crafted with <i class="fa fa-heart"></i> by&nbsp;Hello&nbsp;|&nbsp;<a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yiliashaw/hexo-theme-prince" target="_blank">Prince</a> by SHAW</p></div></footer><script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script><script src="/js/bootstrap.min.js"></script><script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/3.0.47/jquery.fancybox.min.js"></script><script src="/js/script.js"></script></body></html>